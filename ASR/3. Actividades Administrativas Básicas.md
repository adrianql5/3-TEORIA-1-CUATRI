# 3.1 Gestión de procesos
Un proceso es una instancia de un programa en ejecución. En cada momento se están ejecutando un gran número de procesos:
- procesos de sistema (kernel, servicios o daemons)
- procesos de usuario

Una CPU puede constar de varios núcleos. El planificador de procesos se encarga de asignar los procesos a los núcleos en función de su prioridad. En la planificación con asignación dinámica los procesos pueden cambiar de núcleo al pasar a estado activo si el último núcleo en el que se ejecutó está ocupado y existe otro núcleo ocioso. No obstante, la migración de un proceso de un núcleo a otro es costosa. Por tanto, siempre que sea posible se intentará evitar para no incurrir en la penalización de los fallos de caché que resultan de la migración de procesos.

Un proceso se puede componer de varios subprocesos (hilos). Tanto los procesos como los hilos son secuencias independientes de ejecución.La diferencia es que los hilos (del mismo proceso) comparten su espacio de direcciones virtuales y recursos del sistema, mientras que los procesos se ejecutan en espacios de memoria separados.

En esta sección trataremos la gestión de los procesos que se ejecutan:
- **listar procesos en ejecución**
- **detener y matar procesos**
- **controlar la prioridad de ejecución**

![[Pasted image 20251013130143.png]]

## 3.1.1 Ver los procesos en ejecución
Existen varias herramientas para ver los procesos en ejecución, la más importante es `ps` 

### ps (process status)
Lista los procesos son su **PID** (identificador de proceso), **TTY** (número de terminal), **TIME** (tiempo de cpu usado) y **CMD** (línea de comando usada).

![[Pasted image 20251013130524.png]]

Sin opciones, `ps` sólo muestra los procesos lanzados desde la terminal actual y con el mismo EUID que el usuario que lo lanzó.

Tipos de opciones:
- **Opciones UNIX:** `ps -e`
- **Opciones BSD:** `ps ax` 
- **Opciones largas GNU:** `ps --user tomas` 

- `-e`: muestra todos los procesos
- `-u`: muestra los procesos de un usuario
- `-o`: permite definir el formato de salida

![[Pasted image 20251013130913.png]]

![[Pasted image 20251013131040.png]]

En cuento al estado (código state), son posibles entre otros: 
![[Pasted image 20251013131001.png]]

### pstree
Muestra el árbol de procesos
![[Pasted image 20251013131148.png]]

### top
Nos da una lista de procesos actualizada periódicamente
![[Pasted image 20251013131300.png]]

En la cabecera nos muestra un resumen del estado del sistema:
- hora actual, tiempo que lleva el sistema encendido, el número de usuarios conectados y la carga media del sistema para los últimos 1, 5, 15 mins
- Número total de tareas y resumen por estado
- estado de ocupación de la CPU y la memoria. En un sistema $n$ núcleos el máximo uso de CPU es $n\times100$ % 
Por defecto, los procesos se muestran ordenados por porcentaje de uso de CPU. Pulsando h mientras se ejecuta top, obtenemos una lista de comandos interactivos. Los campos de las columnas tienen un significados similar a los del comando ps y se pueden seleccionar interactivamente pulsando f. Para salir, q.

### strace
Muestra las llamadas al sistema realizadas por un proceso en ejecución
![[Pasted image 20251013132152.png]]

### Ejecución en segundo plano
Por defecto, los comandos corren en primer plano (foreground): el shell espera a que termine el comando antes de aceptar uno nuevo.
- para ejecutar un comando en segundo plano se añade &
![[Pasted image 20251013132304.png]]

- para terminar un proceso en foreground Ctrl-C
- para pasar un comando en foreground usar Ctrl-Z
	- `bg` pasa el proceso a background
	- `fg` lo devuelve a foreground

![[Pasted image 20251013132449.png]]

El comando jobs permite ver la lista de comandos (jobs) en background lanzados desde el shell, así como su estado (fg y bg pueden actuar sobre uno de los jobs identificándo por su número)
![[Pasted image 20251013132516.png]]

## 3.1.2 Señalización de procesos
El comando básico para enviar señales a un proceso el `kill` 
- Si el proceso se lanzó en foreground se pueden enviar algunas señales desde teclado
- `kill -l` lista el conjunto de señales
![[Pasted image 20251013152508.png]]

- Para ver lo que hace cada señal `man 7 signal` 

La sintaxis de `kill`:
- `kill [señal] PID` 
- `kill -9` es equivalente a `kill -SIGKILL` 

Las señales más comunes son:
- `SIGTERM:` mata al proceso permitiéndole terminar correctamente
- `SIGKILL:` mata al proceso inmediatamente
- `SIGSTOP:` detiene temporalmente el proceso
- `SIGCONT:` continua si el proceso fue parado
- `SIGINT:` interrupción de teclado (Ctrl+C), mata el proceso
- `SIGTSTP:` stop de teclado (Ctrl+Z) para temporalmente el proceso

Algunas carácterísticas:
